<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cargo">
	<select id="selectAll" resultType="cargo">
		SELECT * FROM cargo
	</select>

	<insert id="insertCargo" parameterType="java.util.List">
		INSERT INTO cargo (item_id, status_id)
		VALUES
		<foreach item="cargo" collection="list" separator=",">
			(#{cargo.itemId}, #{cargo.statusId})
		</foreach>
	</insert>

	<select id="selectStock" resultType="Stock" parameterType="com.bit.shoppingmall.dto.StockSearchDto">
		SELECT i.item_id AS itemId, i.item_name AS itemName, COUNT(*) AS cnt
		FROM item i
		LEFT JOIN cargo c ON i.item_id = c.item_id
		WHERE c.status_id=3
		<if test="itemName != null and itemName != ''">
			AND i.item_name LIKE #{itemName}
		</if>
		GROUP BY i.item_id
		LIMIT #{pageSize} OFFSET #{offset}
	</select>

	<select id="countStock" resultType="Integer" parameterType="com.bit.shoppingmall.dto.StockSearchDto">
		SELECT count(*)
		FROM(
				SELECT i.item_id AS itemId, i.item_name AS itemName, COUNT(*) AS cnt
				FROM item i
				LEFT JOIN cargo c ON i.item_id = c.item_id
				WHERE c.status_id=3
				<if test="itemName != null and itemName != ''">
					AND i.item_name LIKE #{itemName}
				</if>
				GROUP BY i.item_id
			) t
	</select>


</mapper>






