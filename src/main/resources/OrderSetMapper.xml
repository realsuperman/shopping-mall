<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="order">
    <select id="getConsumerOrderSetList" parameterType="Long" resultType="orderSetDto">
        SELECT os.order_set_id AS orderSetId,
               os.order_code AS orderCode,
               os.order_address AS orderAddress,
               os.order_phone_number AS orderPhoneNumber,
               COUNT(DISTINCT (i.item_id)) AS distinctItemCount,
               (SELECT i2.item_name
                FROM order_detail AS od2
                         JOIN order_set AS os2 ON od2.order_set_id = os2.order_set_id
                         JOIN cargo AS c2 ON od2.cargo_id = c2.cargo_id
                         JOIN item AS i2 ON i2.item_id = c2.item_id
                LIMIT 1) AS representative
        FROM order_detail AS od
                 JOIN order_set AS os ON od.order_set_id = os.order_set_id
                 JOIN cargo AS c ON od.cargo_id = c.cargo_id
                 JOIN item AS i ON i.item_id = c.item_id
        WHERE os.consumer_id = #{consumer_id}
        GROUP BY os.order_set_id
    </select>
</mapper>






